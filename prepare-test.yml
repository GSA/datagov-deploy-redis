---
- hosts: localhost
  tasks:
    - name: Replace .kitchen.yml for ansible-redis role
      copy:
        src: files/test/.kitchen.yml
        dest: vendor/ansible-redis/.kitchen.yml

    - name: Copy role vars for testing
      copy:
        src: vars/main.yml
        dest: vendor/ansible-redis/vars.yml

    - name: Replace kitchen driver in Gemfile
      lineinfile:
        path: vendor/ansible-redis/Gemfile
        regexp: '^gem "kitchen-vagrant"'
        line: 'gem "kitchen-docker"'

    - name: enable overcommit in sysctl
      become: true
      sysctl:
        name: vm.overcommit_memory
        value: 1
        state: present
        reload: yes
        ignoreerrors: yes